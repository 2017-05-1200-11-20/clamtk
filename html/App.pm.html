<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Sun Mar  9 08:17:54 2014 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>App.pm</title>
<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #FFFFFF;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
</head>
<body>
<a name="-top-"></a>
<h1>App.pm</h1>
<hr />
<!-- contents of filename: App.pm -->
<pre>
<span class="c"># ClamTk, copyright (C) 2004-2014 Dave M</span>
<span class="c">#</span>
<span class="c"># This file is part of ClamTk (http://code.google.com/p/clamtk/).</span>
<span class="c">#</span>
<span class="c"># ClamTk is free software; you can redistribute it and/or modify it</span>
<span class="c"># under the terms of either:</span>
<span class="c">#</span>
<span class="c"># a) the GNU General Public License as published by the Free Software</span>
<span class="c"># Foundation; either version 1, or (at your option) any later version, or</span>
<span class="c">#</span>
<span class="c"># b) the &quot;Artistic License&quot;.</span>
<a name="package-ClamTk::App-"></a><span class="k">package </span><span class="i">ClamTk::App</span><span class="sc">;</span>

<span class="c"># use strict;</span>
<span class="c"># use warnings;</span>
<span class="i">$|</span> = <span class="n">1</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">Time::Piece</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">File::Basename</span> <span class="q">&#39;basename&#39;</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">POSIX</span> <span class="q">&#39;locale_h&#39;</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Locale::gettext</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Encode</span> <span class="q">&#39;decode&#39;</span><span class="sc">;</span>

<a name="get_TK_version-"></a><span class="k">sub </span><span class="m">get_TK_version</span> <span class="s">{</span>
    <span class="c"># Stick with %.2f format - 4.50 vice 4.5</span>
    <span class="k">return</span> <span class="q">&#39;5.05&#39;</span><span class="sc">;</span>
<span class="s">}</span>

<a name="get_path-"></a><span class="k">sub </span><span class="m">get_path</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="k">undef</span><span class="cm">,</span> <span class="i">$wanted</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$path</span><span class="sc">;</span>

    <span class="c"># These are directories and files necessary for</span>
    <span class="c"># preferences, storing AV signatures, and more</span>

    <span class="c"># Images directory:</span>
    <span class="c"># This is a &quot;global&quot; setting which may need</span>
    <span class="c"># to be changed depending on distro, so it&#39;s first</span>
    <span class="i">$path</span>-&gt;{ <span class="w">images</span> } = <span class="q">&#39;/usr/share/pixmaps/&#39;</span><span class="sc">;</span>

    <span class="c"># Now, determine home directory</span>
    <span class="i">$path</span>-&gt;{ <span class="w">directory</span> } = <span class="i">$ENV</span>{ <span class="w">HOME</span> } || <span class="s">(</span> <span class="s">(</span> <span class="k">getpwuid</span> <span class="i">$&lt;</span> <span class="s">)</span>[ <span class="n">-2</span> ] <span class="s">)</span><span class="sc">;</span>

    <span class="c"># Default personal clamtk directory</span>
    <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } = <span class="i">$path</span>-&gt;{ <span class="w">directory</span> } . <span class="q">&#39;/.clamtk&#39;</span><span class="sc">;</span>

    <span class="c"># For storing quarantined files</span>
    <span class="i">$path</span>-&gt;{ <span class="w">viruses</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } . <span class="q">&#39;/viruses&#39;</span><span class="sc">;</span>

    <span class="c"># Store history logs here</span>
    <span class="i">$path</span>-&gt;{ <span class="w">history</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } . <span class="q">&#39;/history&#39;</span><span class="sc">;</span>

    <span class="c"># Plain text file for preferences</span>
    <span class="i">$path</span>-&gt;{ <span class="w">prefs</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } . <span class="q">&#39;/prefs&#39;</span><span class="sc">;</span>

    <span class="c"># Plain text file for restoring quarantined files</span>
    <span class="i">$path</span>-&gt;{ <span class="w">restore</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } . <span class="q">&#39;/restore&#39;</span><span class="sc">;</span>

    <span class="c"># The db directory stores virus defs/freshclam-related stuff</span>
    <span class="i">$path</span>-&gt;{ <span class="w">db</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } . <span class="q">&#39;/db&#39;</span><span class="sc">;</span>

    <span class="c"># The submit directory stores file submission information</span>
    <span class="i">$path</span>-&gt;{ <span class="w">submit</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clamtk</span> } . <span class="q">&#39;/submit&#39;</span><span class="sc">;</span>

    <span class="c"># Keeps track of previous VT submissions</span>
    <span class="i">$path</span>-&gt;{ <span class="w">previous_submissions</span> }
        = <span class="i">$path</span>-&gt;{ <span class="w">submit</span> } . <span class="q">&#39;/previous_submissions&#39;</span><span class="sc">;</span>

    <span class="c"># Keeps track of previous VT submissions</span>
    <span class="i">$path</span>-&gt;{ <span class="w">virustotal_links</span> } = <span class="i">$path</span>-&gt;{ <span class="w">submit</span> } . <span class="q">&#39;/virustotal_links&#39;</span><span class="sc">;</span>

    <span class="c"># Default variables</span>
    <span class="i">$path</span>-&gt;{ <span class="w">whitelist_dir</span> }
        = <span class="k">join</span><span class="s">(</span> <span class="q">&#39;;&#39;</span><span class="cm">,</span> <span class="i">$path</span>-&gt;{ <span class="w">viruses</span> }<span class="cm">,</span> <span class="q">&#39;/sys&#39;</span><span class="cm">,</span> <span class="q">&#39;/dev&#39;</span><span class="cm">,</span> <span class="q">&#39;/proc;&#39;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c"># Most times freshclam is under /usr/bin</span>
    <span class="i">$path</span>-&gt;{ <span class="w">freshclam</span> }
        = <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/usr/bin/freshclam&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/usr/bin/freshclam&#39;</span>
        <span class="co">:</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/usr/local/bin/freshclam&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/usr/local/bin/freshclam&#39;</span>
        <span class="co">:</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/opt/local/bin/freshclam&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/opt/local/bin/freshclam&#39;</span>
        <span class="co">:</span>                                     <span class="q">&#39;&#39;</span><span class="sc">;</span>

    <span class="c"># Use sigtool for db info</span>
    <span class="i">$path</span>-&gt;{ <span class="w">sigtool</span> }
        = <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/usr/bin/sigtool&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/usr/bin/sigtool&#39;</span>
        <span class="co">:</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/usr/local/bin/sigtool&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/usr/local/bin/sigtool&#39;</span>
        <span class="co">:</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/opt/local/bin/sigtool&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/opt/local/bin/sigtool&#39;</span>
        <span class="co">:</span>                                   <span class="q">&#39;&#39;</span><span class="sc">;</span>

    <span class="c"># Most times clamscan is under /usr/bin</span>
    <span class="c"># We&#39;ll use clampath as the actual path</span>
    <span class="c"># and clamscan as clampath + scan options</span>
    <span class="i">$path</span>-&gt;{ <span class="w">clampath</span> }
        = <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/usr/bin/clamscan&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/usr/bin/clamscan&#39;</span>
        <span class="co">:</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/usr/local/bin/clamscan&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/usr/local/bin/clamscan&#39;</span>
        <span class="co">:</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&#39;/opt/local/bin/clamscan&#39;</span> <span class="s">)</span> ? <span class="q">&#39;/opt/local/bin/clamscan&#39;</span>
        <span class="co">:</span>                                    <span class="q">&#39;&#39;</span><span class="sc">;</span>

    <span class="i">$path</span>-&gt;{ <span class="w">clamscan</span> } = <span class="i">$path</span>-&gt;{ <span class="w">clampath</span> }<span class="sc">;</span>

    <span class="c"># The default ClamAV options:</span>
    <span class="c"># leave out the summary and warn on encrypted</span>
    <span class="i">$path</span>-&gt;{ <span class="w">clamscan</span> } .= <span class="q">&#39; --no-summary --block-encrypted &#39;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="s">(</span> <span class="i">$wanted</span> <span class="k">eq</span> <span class="q">&#39;all&#39;</span> <span class="s">)</span> ? <span class="i">$path</span> <span class="co">:</span> <span class="i">$path</span>-&gt;{ <span class="i">$wanted</span> }<span class="sc">;</span>
<span class="s">}</span>

<a name="get_daily_sigs_path-"></a><span class="k">sub </span><span class="m">get_daily_sigs_path</span> <span class="s">{</span>
    <span class="c"># Returns path_of_daily.c?d</span>
    <span class="c"># There are (or have been) 3 formats:</span>
    <span class="c"># 1. The .cld files</span>
    <span class="c"># 2. The .cvd files</span>
    <span class="c"># 3. The {daily,main}.info directories</span>
    <span class="c"># As of 4.23, we&#39;re no longer looking for the .info dirs.</span>
    <span class="c"># The .cvd is the compressed database, while .cld is a</span>
    <span class="c"># previous .cvd/.cld with incremental updates.</span>
    <span class="c"># The problem is that you can end up with both a</span>
    <span class="c"># daily.cvd AND a daily.cld, and it&#39;s a crapshoot as to</span>
    <span class="c"># which one will show the most current date.  So we&#39;ll return</span>
    <span class="c"># just the directory path, compare dates, and return</span>
    <span class="c"># the most current date.</span>

    <span class="c"># Path to the daily.c{l,v}d file(s)</span>
    <span class="k">my</span> <span class="i">$DAILY_PATH</span><span class="sc">;</span>

    <span class="c"># These are the typical directories where the sigs are found.</span>
    <span class="c"># Because CentOS is a little screwy, it will often contain two</span>
    <span class="c"># directories of definitions... The newer one is likely in</span>
    <span class="c"># /var/clamav, so check that first.  Other distros will</span>
    <span class="c"># likely find the defs under /var/lib/clamav.</span>
    <span class="k">my</span> <span class="i">@dirs</span> = <span class="q">qw(</span>
        <span class="q">/var/clamav</span>
        <span class="q">/var/lib/clamav</span>
        <span class="q">/opt/local/share/clamav</span>
        <span class="q">/usr/share/clamav</span>
        <span class="q">/usr/local/share/clamav</span>
        <span class="q">/var/db/clamav</span>
    <span class="q">)</span><span class="sc">;</span>

    <span class="c"># If the user selected &quot;manual&quot;, that directory needs</span>
    <span class="c"># to be checked first, so we&#39;ll jam that in with unshift.</span>
    <span class="k">my</span> <span class="i">$user_set</span>      = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$update_method</span> = <span class="w">ClamTk::Prefs</span><span class="w">-&gt;get_preference</span><span class="s">(</span> <span class="q">&#39;Update&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$update_method</span> <span class="k">eq</span> <span class="q">&#39;single&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$user_set</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$paths</span> = <span class="w">ClamTk::App</span><span class="w">-&gt;get_path</span><span class="s">(</span> <span class="q">&#39;db&#39;</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">unshift</span><span class="s">(</span> <span class="i">@dirs</span><span class="cm">,</span> <span class="i">$paths</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># We&#39;ll search for the daily file then main;</span>
    <span class="c"># Check for daily&#39;s .cld before .cvd,</span>
    <span class="c"># but main&#39;s .cvd before .cld</span>
    <span class="k">my</span> <span class="i">$dupe_db</span> = <span class="w">ClamTk::Prefs</span><span class="w">-&gt;get_preference</span><span class="s">(</span> <span class="q">&#39;DupeDB&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">for</span> <span class="k">my</span> <span class="i">$dir_list</span> <span class="s">(</span> <span class="i">@dirs</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c"># Check for duplicate daily databases</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$dir_list/daily.cld&quot;</span> &amp;&amp; <span class="k">-e</span> <span class="q">&quot;$dir_list/daily.cvd&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">only_one</span><span class="s">(</span> <span class="q">&quot;$dir_list&quot;</span> <span class="s">)</span>
                <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$dupe_db</span> &amp;&amp; <span class="i">$update_method</span> <span class="k">eq</span> <span class="q">&#39;single&#39;</span> <span class="s">)</span>
                <span class="k">or</span> <span class="s">(</span> <span class="i">$dupe_db</span> &amp;&amp; <span class="i">$&gt;</span> == <span class="n">0</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$dir_list/daily.cld&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$DAILY_PATH</span> = <span class="q">&quot;$dir_list/daily.cld&quot;</span><span class="sc">;</span>
        <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$dir_list/daily.cvd&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$DAILY_PATH</span> = <span class="q">&quot;$dir_list/daily.cvd&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">last</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$DAILY_PATH</span> <span class="s">)</span><span class="sc">;</span>

        <span class="c"># the user may have set single - may need to update db</span>
        <span class="k">last</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$user_set</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$DAILY_PATH</span><span class="sc">;</span>
<span class="s">}</span>

<a name="get_main_sigs_path-"></a><span class="k">sub </span><span class="m">get_main_sigs_path</span> <span class="s">{</span>
    <span class="c"># Path to the main.c{l,v}d file(s)</span>
    <span class="k">my</span> <span class="i">$MAIN_PATH</span><span class="sc">;</span>

    <span class="c"># If the user selected &quot;manual&quot;, that directory needs</span>
    <span class="c"># to be checked first, so we&#39;ll jam that in with unshift.</span>
    <span class="k">my</span> <span class="i">$update_method</span> = <span class="w">ClamTk::Prefs</span><span class="w">-&gt;get_preference</span><span class="s">(</span> <span class="q">&#39;Update&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$user_set</span>      = <span class="n">0</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@dirs</span> = <span class="q">qw(</span>
        <span class="q">/var/clamav</span>
        <span class="q">/var/lib/clamav</span>
        <span class="q">/opt/local/share/clamav</span>
        <span class="q">/usr/share/clamav</span>
        <span class="q">/usr/local/share/clamav</span>
        <span class="q">/var/db/clamav</span>
    <span class="q">)</span><span class="sc">;</span>
    <span class="c"># Check for duplicate main databases</span>
    <span class="k">my</span> <span class="i">$dupe_db</span> = <span class="w">ClamTk::Prefs</span><span class="w">-&gt;get_preference</span><span class="s">(</span> <span class="q">&#39;DupeDB&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">for</span> <span class="k">my</span> <span class="i">$dir_list</span> <span class="s">(</span> <span class="i">@dirs</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c"># Check for duplicate daily databases</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$dir_list/main.cld&quot;</span> &amp;&amp; <span class="q">&quot;$dir_list/main.cvd&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">unlink</span><span class="s">(</span> <span class="q">&quot;$dir_list/main.cld&quot;</span> <span class="s">)</span>
                <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$dupe_db</span> &amp;&amp; <span class="i">$update_method</span> <span class="k">eq</span> <span class="q">&#39;single&#39;</span> <span class="s">)</span>
                <span class="k">or</span> <span class="s">(</span> <span class="i">$dupe_db</span> &amp;&amp; <span class="i">$&gt;</span> == <span class="n">0</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$dir_list/main.cvd&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$MAIN_PATH</span> = <span class="q">&quot;$dir_list/main.cvd&quot;</span><span class="sc">;</span>
        <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$dir_list/main.cld&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$MAIN_PATH</span> = <span class="q">&quot;$dir_list/main.cld&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">last</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$MAIN_PATH</span> <span class="s">)</span><span class="sc">;</span>

        <span class="c"># the user may have set single - may need to update db</span>
        <span class="k">last</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$user_set</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$MAIN_PATH</span><span class="sc">;</span>
<span class="s">}</span>

<a name="get_local_sig_version-"></a><span class="k">sub </span><span class="m">get_local_sig_version</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$daily</span> = <span class="i">get_daily_sigs_path</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$sigtool</span> = <span class="i">get_path</span><span class="s">(</span> <span class="k">undef</span><span class="cm">,</span> <span class="q">&#39;sigtool&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$version</span> = <span class="n">0</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="i">$daily</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$CLD</span><span class="cm">,</span> <span class="q">&#39;-|&#39;</span><span class="cm">,</span> <span class="q">&quot;$sigtool -i $daily&quot;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">while</span> <span class="s">(</span> <span class="q">&lt;$CLD&gt;</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="q">/Version: (\d+)/</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$version</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="s">(</span> <span class="i">$version</span> =~ <span class="q">/\d+/</span> <span class="s">)</span> ? <span class="i">$version</span> <span class="co">:</span> <span class="i">_</span><span class="s">(</span> <span class="q">&#39;Unknown&#39;</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<a name="only_one-"></a><span class="k">sub </span><span class="m">only_one</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$location</span> <span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$basename</span> = <span class="i">basename</span><span class="s">(</span> <span class="i">$location</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$cld</span><span class="cm">,</span> <span class="i">$cvd</span> <span class="s">)</span> = <span class="s">(</span> <span class="q">&#39;01 Jan 1900&#39;</span> <span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sigtool</span> = <span class="i">get_path</span><span class="s">(</span> <span class="k">undef</span><span class="cm">,</span> <span class="q">&#39;sigtool&#39;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$CLD</span><span class="cm">,</span> <span class="q">&#39;-|&#39;</span><span class="cm">,</span> <span class="q">&quot;$sigtool -i $location/daily.cld&quot;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">while</span> <span class="s">(</span> <span class="q">&lt;$CLD&gt;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="q">/Build time: (\d+\s\w+\s\d{4})/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$cld</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="k">last</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
        <span class="c"># shouldn&#39;t happen</span>
        <span class="i">$cld</span> = <span class="q">&#39;01 01 1970&#39;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$CVD</span><span class="cm">,</span> <span class="q">&#39;-|&#39;</span><span class="cm">,</span> <span class="q">&quot;$sigtool -i $location/daily.cvd&quot;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">while</span> <span class="s">(</span> <span class="q">&lt;$CVD&gt;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="q">/Build time: (\d+\s\w+\s\d{4})/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$cvd</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="k">last</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span> <span class="k">else</span> <span class="s">{</span>
        <span class="c"># shouldn&#39;t happen</span>
        <span class="i">$cvd</span> = <span class="q">&#39;01 01 1970&#39;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$cmp</span> = <span class="i">comp_dates</span><span class="s">(</span> <span class="i">$cld</span><span class="cm">,</span> <span class="i">$cvd</span> <span class="s">)</span><span class="sc">;</span>
    <span class="c"># If cmp == -1, cvd is newer.</span>
    <span class="c"># If cmp ==  1, cld is newer.</span>
    <span class="c"># If cmp ==  0, they&#39;re the same.</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$cmp</span> == <span class="n">-1</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">unlink</span><span class="s">(</span> <span class="q">&quot;$location/daily.cld&quot;</span> <span class="s">)</span>
            <span class="k">or</span> <span class="k">warn</span> <span class="q">&quot;Cannot delete $location/daily.cld: $!\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="i">$cmp</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">unlink</span><span class="s">(</span> <span class="q">&quot;$location/daily.cvd&quot;</span> <span class="s">)</span>
            <span class="k">or</span> <span class="k">warn</span> <span class="q">&quot;Cannot delete $location/daily.cvd: $!\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="i">$cmp</span> == <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">unlink</span><span class="s">(</span> <span class="q">&quot;$location/daily.cvd&quot;</span> <span class="s">)</span>
            <span class="k">or</span> <span class="k">warn</span> <span class="q">&quot;Cannot delete $location/daily.cvd: $!\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="get_AV_version-"></a><span class="k">sub </span><span class="m">get_AV_version</span> <span class="s">{</span>
    <span class="c"># simple &#39;clamscan -V&#39;.</span>
    <span class="c"># We have to parse something like this:</span>
    <span class="c"># ClamAV 0.95.3/11220/Fri Jun 18 22:06:39 2010</span>
    <span class="c"># Worth keeping an eye on since it&#39;s changed in</span>
    <span class="c"># past without me noticing...</span>
    <span class="k">local</span> <span class="i">$ENV</span>{ <span class="q">&#39;PATH&#39;</span> } = <span class="q">&#39;/bin:/usr/bin:/usr/local/bin&#39;</span><span class="sc">;</span>
    <span class="k">delete</span> <span class="i">@ENV</span>{ <span class="q">&#39;IFS&#39;</span><span class="cm">,</span> <span class="q">&#39;CDPATH&#39;</span><span class="cm">,</span> <span class="q">&#39;ENV&#39;</span><span class="cm">,</span> <span class="q">&#39;BASH_ENV&#39;</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$paths</span>   = <span class="w">ClamTk::App</span><span class="w">-&gt;get_path</span><span class="s">(</span> <span class="q">&#39;clampath&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$version</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$c</span><span class="cm">,</span> <span class="q">&#39;-|&#39;</span><span class="cm">,</span> <span class="i">$paths</span><span class="cm">,</span> <span class="q">&#39;-V&#39;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">while</span> <span class="s">(</span> <span class="q">&lt;$c&gt;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">chomp</span><span class="sc">;</span>
            <span class="i">$version</span> = <span class="i">$_</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="i">$version</span> =~ <span class="q">s/^\S+\s+([0-9\.]+).*/$1/</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$version</span> ? <span class="i">$version</span> <span class="co">:</span> <span class="q">&#39;0.00&#39;</span><span class="sc">;</span>
<span class="s">}</span>

<a name="get_sigtool_info-"></a><span class="k">sub </span><span class="m">get_sigtool_info</span> <span class="s">{</span>
    <span class="c"># Should get requests for:</span>
    <span class="c"># count: add up daily/main sigs</span>
    <span class="c"># version: version count found in sigs</span>
    <span class="c"># date: show build time of sigs</span>
    <span class="k">my</span> <span class="s">(</span> <span class="k">undef</span><span class="cm">,</span> <span class="i">$wanted</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$regex</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$wanted</span> <span class="k">eq</span> <span class="q">&#39;date&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c"># Build time: 16 Aug 2013</span>
        <span class="i">$regex</span> = <span class="q">qr|Build time:\s(\d+\s\w+\s\d{4})|</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="i">$wanted</span> <span class="k">eq</span> <span class="q">&#39;version&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c"># Version: 17694</span>
        <span class="i">$regex</span> = <span class="q">qr|Version:\s(\d+)|</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="i">$wanted</span> <span class="k">eq</span> <span class="q">&#39;count&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c"># Signatures: 1614500</span>
        <span class="i">$regex</span> = <span class="q">qr|Signatures: (\d+)|</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$result</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sigtool</span> = <span class="i">get_path</span><span class="s">(</span> <span class="k">undef</span><span class="cm">,</span> <span class="q">&#39;sigtool&#39;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$daily_path</span> = <span class="i">get_daily_sigs_path</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$main_path</span>  = <span class="i">get_main_sigs_path</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$found_wanted</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="i">$daily_path</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$cld_db</span><span class="cm">,</span> <span class="q">&#39;-|&#39;</span><span class="cm">,</span> <span class="q">&quot;$sigtool -i $daily_path&quot;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">while</span> <span class="s">(</span> <span class="q">&lt;$cld_db&gt;</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="q">/$regex/</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="k">chomp</span><span class="sc">;</span>
                    <span class="i">$result</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$wanted</span> <span class="k">eq</span> <span class="q">&#39;sigcount&#39;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="i">$main_path</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$main_db</span><span class="cm">,</span> <span class="q">&#39;-|&#39;</span><span class="cm">,</span> <span class="q">&quot;$sigtool -i $main_path&quot;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">while</span> <span class="s">(</span> <span class="q">&lt;$main_db&gt;</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="k">if</span> <span class="s">(</span> <span class="q">/$regex/</span> <span class="s">)</span> <span class="s">{</span>
                        <span class="k">chomp</span><span class="sc">;</span>
                        <span class="i">$result</span> += <span class="i">$1</span><span class="sc">;</span>
                    <span class="s">}</span>
                <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="c"># If the date is wanted, we have to tweak the results</span>
    <span class="c"># first. Instead of getting translations for each 3 letter</span>
    <span class="c"># month abbreviation, it&#39;s easier to change it to digits</span>
    <span class="c"># and display it as $YEAR $MONTH $DAY (2013 08 01).</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$wanted</span> <span class="k">eq</span> <span class="q">&#39;date&#39;</span> &amp;&amp; <span class="i">$result</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$day</span><span class="cm">,</span> <span class="i">$month</span><span class="cm">,</span> <span class="i">$year</span> <span class="s">)</span> = <span class="k">split</span><span class="s">(</span> <span class="q">/ /</span><span class="cm">,</span> <span class="i">$result</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">%months</span> = <span class="s">(</span>
            <span class="q">&#39;Jan&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;01&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Feb&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;02&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Mar&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;03&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Apr&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;04&#39;</span><span class="cm">,</span>
            <span class="q">&#39;May&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;05&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Jun&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;06&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Jul&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;07&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Aug&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;08&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Sep&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;09&#39;</span><span class="cm">,</span>
            <span class="q">&#39;Oct&#39;</span> <span class="cm">=&gt;</span> <span class="n">10</span><span class="cm">,</span>
            <span class="q">&#39;Nov&#39;</span> <span class="cm">=&gt;</span> <span class="n">11</span><span class="cm">,</span>
            <span class="q">&#39;Dec&#39;</span> <span class="cm">=&gt;</span> <span class="n">12</span><span class="cm">,</span>
        <span class="s">)</span><span class="sc">;</span>
        <span class="i">$result</span> = <span class="k">join</span><span class="s">(</span> <span class="q">&#39; &#39;</span><span class="cm">,</span> <span class="i">$year</span><span class="cm">,</span> <span class="i">$months</span>{ <span class="i">$month</span> }<span class="cm">,</span> <span class="i">$day</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$result</span><span class="sc">;</span>
<span class="s">}</span>

<a name="lastscan-"></a><span class="k">sub </span><span class="m">lastscan</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$path</span> = <span class="w">ClamTk::App</span><span class="w">-&gt;get_path</span><span class="s">(</span> <span class="q">&#39;history&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@logs</span> = <span class="k">glob</span> <span class="q">&quot;$path/*.log&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">_</span><span class="s">(</span> <span class="q">&#39;Never&#39;</span> <span class="s">)</span> <span class="k">if</span> <span class="s">(</span> !<span class="i">@logs</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%orcs</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@newer</span>
        = <span class="k">sort</span> <span class="s">{</span> <span class="s">(</span> <span class="i">$orcs</span>{ <span class="i">$a</span> } ||= <span class="k">-M</span> <span class="i">$a</span> <span class="s">)</span> &lt;=&gt; <span class="s">(</span> <span class="i">$orcs</span>{ <span class="i">$b</span> } ||= <span class="k">-M</span> <span class="i">$b</span> <span class="s">)</span> <span class="s">}</span>
        <span class="i">@logs</span><span class="sc">;</span>

    <span class="c"># The newest &quot;file&quot; (actually a string/scalar)</span>
    <span class="c"># is a path like /home/foo/.clamtk/histories/01-01-Jan.log.</span>
    <span class="c"># We just want the basename of that.</span>
    <span class="k">my</span> <span class="i">$chosen</span> = <span class="i">basename</span><span class="s">(</span> <span class="i">$newer</span>[ <span class="n">0</span> ] <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$month</span><span class="cm">,</span> <span class="i">$day</span><span class="cm">,</span> <span class="i">$year</span> <span class="s">)</span> = <span class="k">split</span><span class="s">(</span> <span class="q">/-/</span><span class="cm">,</span> <span class="i">$chosen</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$year</span> =~ <span class="q">s/(\d+)\.log/$1/</span><span class="sc">;</span>

    <span class="k">return</span> <span class="q">&quot;$day $month $year&quot;</span><span class="sc">;</span>
<span class="s">}</span>

<a name="comp_dates-"></a><span class="k">sub </span><span class="m">comp_dates</span> <span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$cld</span><span class="cm">,</span> <span class="i">$cvd</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%months</span> = <span class="s">(</span>
        <span class="q">&#39;Jan&#39;</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
        <span class="q">&#39;Feb&#39;</span> <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span>
        <span class="q">&#39;Mar&#39;</span> <span class="cm">=&gt;</span> <span class="n">3</span><span class="cm">,</span>
        <span class="q">&#39;Apr&#39;</span> <span class="cm">=&gt;</span> <span class="n">4</span><span class="cm">,</span>
        <span class="q">&#39;May&#39;</span> <span class="cm">=&gt;</span> <span class="n">5</span><span class="cm">,</span>
        <span class="q">&#39;Jun&#39;</span> <span class="cm">=&gt;</span> <span class="n">6</span><span class="cm">,</span>
        <span class="q">&#39;Jul&#39;</span> <span class="cm">=&gt;</span> <span class="n">7</span><span class="cm">,</span>
        <span class="q">&#39;Aug&#39;</span> <span class="cm">=&gt;</span> <span class="n">8</span><span class="cm">,</span>
        <span class="q">&#39;Sep&#39;</span> <span class="cm">=&gt;</span> <span class="n">9</span><span class="cm">,</span>
        <span class="q">&#39;Oct&#39;</span> <span class="cm">=&gt;</span> <span class="n">10</span><span class="cm">,</span>
        <span class="q">&#39;Nov&#39;</span> <span class="cm">=&gt;</span> <span class="n">11</span><span class="cm">,</span>
        <span class="q">&#39;Dec&#39;</span> <span class="cm">=&gt;</span> <span class="n">12</span><span class="cm">,</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$cld_day</span><span class="cm">,</span> <span class="i">$cld_mon</span><span class="cm">,</span> <span class="i">$cld_year</span> <span class="s">)</span> = <span class="k">split</span><span class="s">(</span> <span class="q">/\s/</span><span class="cm">,</span> <span class="i">$cld</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$cvd_day</span><span class="cm">,</span> <span class="i">$cvd_mon</span><span class="cm">,</span> <span class="i">$cvd_year</span> <span class="s">)</span> = <span class="k">split</span><span class="s">(</span> <span class="q">/\s/</span><span class="cm">,</span> <span class="i">$cvd</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$cld_zone</span> = <span class="i">$cld_day</span> . <span class="q">&#39; &#39;</span> . <span class="i">$months</span>{ <span class="i">$cld_mon</span> } . <span class="q">&#39; &#39;</span> . <span class="i">$cld_year</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$cvd_zone</span> = <span class="i">$cvd_day</span> . <span class="q">&#39; &#39;</span> . <span class="i">$months</span>{ <span class="i">$cvd_mon</span> } . <span class="q">&#39; &#39;</span> . <span class="i">$cld_year</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$date_format</span> = <span class="q">&#39;%d %m %Y&#39;</span><span class="sc">;</span>

    <span class="i">$cld_zone</span> = <span class="w">Time::Piece</span><span class="w">-&gt;strptime</span><span class="s">(</span> <span class="i">$cld_zone</span><span class="cm">,</span> <span class="i">$date_format</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$cvd_zone</span> = <span class="w">Time::Piece</span><span class="w">-&gt;strptime</span><span class="s">(</span> <span class="i">$cvd_zone</span><span class="cm">,</span> <span class="i">$date_format</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$cmp</span> = <span class="s">(</span> <span class="i">$cld_zone</span> <span class="s">)</span> &lt;=&gt; <span class="s">(</span> <span class="i">$cvd_zone</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c"># If cmp == -1, cvd is newer.</span>
    <span class="c"># If cmp ==  1, cld is newer.</span>
    <span class="c"># If cmp ==  0, they&#39;re the same.</span>

    <span class="k">return</span> <span class="i">$cmp</span><span class="sc">;</span>
<span class="s">}</span>

<a name="translate-"></a><span class="k">sub </span><span class="m">translate</span> <span class="s">{</span>
    <span class="c"># This is a dummy routine, solely for the .desktop file</span>
    <span class="c"># and other spots...</span>
    <span class="k">my</span> <span class="i">$a</span> = <span class="i">_</span><span class="s">(</span> <span class="q">&#39;Scan for threats...&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$a</span> = <span class="i">_</span><span class="s">(</span> <span class="q">&#39;Advanced&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$a</span> = <span class="i">_</span><span class="s">(</span> <span class="q">&#39;Scan a file&#39;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$a</span> = <span class="i">_</span><span class="s">(</span> <span class="q">&#39;Scan a directory&#39;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$a</span><span class="sc">;</span>
<span class="s">}</span>

<a name="_-"></a><span class="k">sub </span><span class="m">_</span> <span class="s">{</span>
    <span class="c"># stupid gettext wrapper</span>
    <span class="k">return</span> <span class="i">decode</span><span class="s">(</span> <span class="q">&#39;utf8&#39;</span><span class="cm">,</span> <span class="i">gettext</span><span class="s">(</span> <span class="i">$_</span>[ <span class="n">0</span> ] <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="n">1</span><span class="sc">;</span>
<a name="EOF-"></a></pre>
</body>
</html>
